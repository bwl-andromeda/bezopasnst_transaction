# Отчет о выполнении задачи "Интернет-транзакции"

## Постановка задачи

Задача заключается в реализации web-сервиса таким образом, чтобы транзакции, которые проводились на данном сайте, были безопасны.

### Цели и Предположения Безопасности (ЦПБ)

#### Цели:
1. Обеспечение безопасности передачи данных платежа
2. Предоставление уникальных данных для каждой транзакции
3. Обеспечение конфиденциальности данных
4. Целостность транзакций и успешная доставка

#### Предположения:
1. Применение второго фактора как предоставление безопасности для авторизации транзакции
2. Токен одноразового пароля (OTP), основанный на времени, например OATH TOTP (одноразовый пароль на основе времени)
3. OTP, отправленный по SMS или предоставленный по телефону
4. Цифровая подпись, предоставленная смарт-картой или смартфоном
5. Токен запроса-ответа, включая автономные устройства считывания карт или решения, сканирующие данные транзакций с экрана компьютера пользователя

## Архитектура решения

### Компоненты

| Название | Назначение |
|----|----|
| *Веб-сервис* | Реализация бизнес-логики в виде микросервисов по предоставлению услуг, которые связаны с транзакциями |
| *Мобильное приложение* | Реализация бизнес-логики на мобильном устройстве |
| *Модуль безопасности контроля авторизаций* | Отдельный микросервис, который отвечает за авторизацию транзакций |
| *Центр транзакций* | Отдельный микросервис, который проводит транзакции |

[Архитектура](architecture.png "Общая архитектура")

### Алгоритм работы решения
1. Пользователь инициирует транзакцию через веб-сервис или мобильное приложение.
2. Веб-сервис или мобильное приложение отправляет запрос на авторизацию в модуль безопасности контроля авторизаций.
3. Модуль безопасности контроля авторизаций запрашивает второй фактор аутентификации у пользователя (например, OTP).
4. Пользователь предоставляет второй фактор аутентификации.
5. Модуль безопасности контроля авторизаций проверяет предоставленные данные и, в случае успеха, генерирует уникальный токен для транзакции.
6. Веб-сервис или мобильное приложение отправляет запрос на проведение транзакции в центр транзакций, включая уникальный токен.
7. Центр транзакций проверяет токен у модуля безопасности контроля авторизаций.
8. При успешной проверке токена центр транзакций проводит транзакцию.
9. Центр транзакций отправляет подтверждение о выполнении транзакции веб-сервису или мобильному приложению.
10. Веб-сервис или мобильное приложение информирует пользователя об успешном завершении транзакции.

## Безопасность

### Выполнение целей безопасности

#### Обеспечение безопасности передачи данных платежа
1. Использование протокола HTTPS для шифрования всех коммуникаций между компонентами системы.
2. Применение современных алгоритмов шифрования для защиты данных в процессе передачи.

#### Предоставление уникальных данных для каждой транзакции
1. Генерация уникального токена для каждой транзакции модулем безопасности контроля авторизаций.
2. Использование временных меток и случайных чисел для обеспечения уникальности токенов.

#### Обеспечение конфиденциальности данных
1. Хранение чувствительных данных в зашифрованном виде.
2. Применение принципа минимальных привилегий для доступа к данным.
3. Использование токенизации для замены реальных данных карт на токены при обработке платежей.

#### Целостность транзакций и успешная доставка
1. Использование цифровых подписей для обеспечения целостности данных транзакций.
2. Реализация механизма подтверждения и сверки транзакций.
3. Внедрение системы мониторинга и логирования для отслеживания статуса транзакций.

### Негативные сценарии и защита от них

#### Негативный сценарий: Перехват данных
Злоумышленники могут попытаться перехватить данные транзакций, если безопасность соединения будет нарушена (например, в случае атаки типа "человек посередине").

##### Защита от негативного сценария:
1. Использование современных криптографических протоколов и сертификатов с надежной верификацией.
2. Внедрение HTTP Strict Transport Security ([HSTS](https://www.directline.pro/blog/tekhnologiya-hsts/)) и Certificate Pinning.

#### Негативный сценарий: Нарушение целостности токенов
Слабая генерация токенов может привести к повторным атакам (replay) или подмене транзакций.

##### Защита от негативного сценария:
1. Применение криптографически стойких методов генерации токенов (например, на основе HMAC).
2. Введение временных ограничений для использования токенов и предотвращение их повторного использования.

#### Негативный сценарий: Атаки на второй фактор аутентификации
Использование SMS для одноразовых паролей (OTP) может привести к атакам, таким как подмена SIM-карты.

##### Защита от негативного сценария:
1. Переход на более безопасные методы аутентификации, такие как приложения для генерации OTP или аппаратные ключи безопасности.
2. Защита от атак на замену SIM-карты с помощью многофакторной аутентификации.

#### Негативный сценарий: Компрометация веб-сервиса
Веб-сервис может стать уязвимым к несанкционированному доступу или атакам, если его не обновлять.

##### Защита от негативного сценария:
1. Регулярное обновление веб-сервиса и патчинг уязвимостей.
2. Ограничение доступа к чувствительным данным и использование принципа минимальных привилегий.

#### Негативный сценарий: Компрометация мобильного приложения
Вредоносное ПО на устройстве пользователя может скомпрометировать данные аутентификации.

##### Защита от негативного сценария:
1. Внедрение защиты от [руткитов](https://www.kaspersky.ru/blog/chto-takoe-rutkit-i-kak-udalit-ego-s-kompyutera/650/) и [джейлбрейков](https://www.kaspersky.ru/resource-center/definitions/what-is-jailbreaking).
2. Шифрование локальных данных на устройстве.

#### Негативный сценарий: Компрометация модуля безопасности контроля авторизаций
Злоумышленники могут попытаться скомпрометировать модуль безопасности и обойти двухфакторную аутентификацию.

##### Защита от негативного сценария:
1. Изоляция модуля в защищенной сети.
2. Использование аппаратных модулей безопасности [HSM](https://informationsecurityasia.com/ru/what-is-a-hardware-security-module-hsm/) для защиты криптографических ключей.

#### Негативный сценарий: Атака DDoS
Массовая атака на систему может сделать ее недоступной для пользователей.

##### Защита от негативного сценария:
1. Внедрение DDoS-защиты на уровне инфраструктуры с использованием [CDN](https://habr.com/ru/companies/selectel/articles/463915/) и специализированных сервисов.
2. Настройка автоматических фильтров для ограничения трафика.

## Тестирование

### Функциональное тестирование
1. Проверка успешного проведения транзакции с корректными данными.
2. Тестирование отказа в проведении транзакции при неверном втором факторе аутентификации.
3. Проверка уникальности генерируемых токенов для каждой транзакции.
4. Тестирование корректной работы системы при высокой нагрузке.

### Тестирование безопасности
1. Проведение тестирования на проникновение для всех компонентов системы. Пример: [Техника тестирования Black Box](https://mate.academy/blog/ru/qa-ru/black-box-testing/)
2. Сканирование на наличие известных уязвимостей в используемом программном обеспечении. Использование направления методов [DevSecOps](https://habr.com/ru/companies/mws/articles/723862/). [White Box](https://habr.com/ru/articles/549054/) - SAST,SCA,BSCA
3. Тестирование устойчивости системы к атакам типа "человек посередине" ([MITM](https://encyclopedia.kaspersky.ru/glossary/man-in-the-middle-attack/)).
4. Проверка корректности работы механизмов шифрования и хеширования.

### Нагрузочное тестирование
1. Симуляция высокой нагрузки на систему для проверки ее производительности и стабильности. Пример инструмента который может это сделать: [Postman](https://www.postman.com/)
2. Тестирование системы на устойчивость к DDoS-атакам.

### Тестирование отказоустойчивости
1. Проверка работоспособности системы при отказе одного из компонентов.
2. Тестирование механизмов восстановления после сбоев.

## Заключение

Предложенная архитектура решения для обеспечения безопасности интернет-транзакций учитывает основные аспекты безопасности, включая конфиденциальность, целостность и доступность данных. Использование микросервисной архитектуры позволяет обеспечить гибкость и масштабируемость системы, а также изолировать критические компоненты для повышения общего уровня безопасности.

Внедрение многофакторной аутентификации, уникальных токенов для каждой транзакции и строгих механизмов авторизации значительно снижает риски несанкционированного доступа и мошенничества. Регулярное тестирование и аудит безопасности, а также постоянный мониторинг системы позволят своевременно выявлять и устранять потенциальные уязвимости.

Для дальнейшего повышения уровня безопасности рекомендуется рассмотреть возможность внедрения дополнительных технологий, таких как машинное обучение для выявления аномального поведения и блокчейн для обеспечения неизменяемости и прозрачности транзакций.

---

## Источники данных на котором основывался данный отчет:
[OWASP.ORG](https://cheatsheetseries.owasp.org/cheatsheets/Transaction_Authorization_Cheat_Sheet.html)

---

## Термины из статьей которые тут используются:

- https://www.postman.com/
- https://encyclopedia.kaspersky.ru/glossary/man-in-the-middle-attack/
- https://habr.com/ru/articles/549054/
- https://mate.academy/blog/ru/qa-ru/black-box-testing/
- https://habr.com/ru/companies/mws/articles/723862/
- https://habr.com/ru/companies/selectel/articles/463915/
- https://informationsecurityasia.com/ru/what-is-a-hardware-security-module-hsm/
- https://www.kaspersky.ru/blog/chto-takoe-rutkit-i-kak-udalit-ego-s-kompyutera/650/
- https://www.kaspersky.ru/resource-center/definitions/what-is-jailbreaking
- https://www.directline.pro/blog/tekhnologiya-hsts/
